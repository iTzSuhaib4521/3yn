<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø£Ø³Ø±Ø¹ ÙˆØ§Ø­Ø¯ ÙŠØ¶ØºØ· Ø§Ù„Ø²Ø±</title>
  <script src="/socket.io/socket.io.js"></script>

  <style>
    body {
      background: #0f172a;
      color: white;
      font-family: Arial;
      text-align: center;
      padding-top: 60px;
    }

    input, button {
      padding: 12px;
      font-size: 16px;
      margin: 6px;
      border-radius: 8px;
      border: none;
    }

    input {
      width: 220px;
    }

    button {
      cursor: pointer;
      background: #22c55e;
      color: black;
    }

    #gameBtn {
      font-size: 30px;
      padding: 25px 50px;
      background: #facc15;
      margin-top: 20px;
    }

    ul {
      list-style: none;
      padding: 0;
    }
  </style>
</head>
<body>

<h1>âš¡ Ø£Ø³Ø±Ø¹ ÙˆØ§Ø­Ø¯ ÙŠØ¶ØºØ· Ø§Ù„Ø²Ø±</h1>

<div id="login">
  <input id="name" placeholder="Ø§Ø³Ù…Ùƒ">
  <br>
  <button onclick="createRoom()">Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ©</button>
  <br>
  <input id="code" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©">
  <button onclick="joinRoom()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div id="room" style="display:none">
  <h2>ğŸ“¦ Ø§Ù„ØºØ±ÙØ©: <span id="roomCode"></span></h2>

  <button id="gameBtn" onclick="press()">Ø§Ø¶ØºØ·!</button>
  <br><br>
  <button onclick="reset()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¬ÙˆÙ„Ø©</button>

  <h3 id="winnerText">â€”</h3>

  <h3>ğŸ† Ø§Ù„Ù†Ù‚Ø§Ø·</h3>
  <ul id="players"></ul>
</div>

<script>
  const socket = io();
  let roomCode = null;

  function createRoom() {
    const name = getName();
    socket.emit("createRoom", name);
  }

  function joinRoom() {
    const name = getName();
    roomCode = document.getElementById("code").value.toUpperCase();
    socket.emit("joinRoom", { code: roomCode, playerName: name });
    enterRoom(roomCode);
  }

  function press() {
    socket.emit("pressButton", roomCode);
  }

  function reset() {
    socket.emit("resetRound", roomCode);
  }

  socket.on("roomCreated", (code) => {
    roomCode = code;
    enterRoom(code);
  });

  socket.on("playersUpdate", (players) => {
    renderPlayers(players);
  });

  socket.on("winner", (data) => {
    document.getElementById("winnerText").textContent =
      `ğŸ¥‡ Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø£ÙˆÙ„: ${data.name}`;
    renderPlayers(data.players);
  });

  socket.on("roundReset", () => {
    document.getElementById("winnerText").textContent =
      "â€” Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ø¯Ø£Øª â€”";
  });

  socket.on("errorMessage", (msg) => {
    alert(msg);
  });

  function renderPlayers(players) {
    const ul = document.getElementById("players");
    ul.innerHTML = "";
    Object.values(players).forEach(p => {
      const li = document.createElement("li");
      li.textContent = `${p.name} â€” â­ ${p.points}`;
      ul.appendChild(li);
    });
  }

  function enterRoom(code) {
    document.getElementById("login").style.display = "none";
    document.getElementById("room").style.display = "block";
    document.getElementById("roomCode").textContent = code;
  }

  function getName() {
    return document.getElementById("name").value || "Ù„Ø§Ø¹Ø¨";
  }
  setInterval(() => {
  if (socket.connected) {
    socket.emit("pingServer");
  }
}, 30000);
</script>

</body>

</html>
